<!DOCTYPE html>
<html>
    <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-29519043-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'UA-29519043-1');
        </script>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:title" content="risou's Lithograph" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://blog.risouf.net" />
        <meta property="og:image" content="https://blog.risouf.net/static/img/sunglass.jpeg" />
        <meta property="og:site_name" content="risou's Lithograph" />
        <meta property="og:description" content="risou's mini blog - writing about software engineering, thinking, private events" /><meta property="fb:app_id" content="2945406965474658" /><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@risou" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
        <link rel="stylesheet" href="/static/main.css">
        <title>risou's Lithograph</title>
    </head>
    <body>
        <section class="hero is-medium is-bold is-dark">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="title is-1">risou's Lithograph</h1>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <nav class="level is-mobile">
                    <div class="level-left"></div>
                    <div class="level-right">
                        <p class="level-item">top</p>
                        <p class="level-item"><a href="/list.html">list</a></p>
                    </div>
                </nav>
                <article class="articles">
                    
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2020-09-19-isucon10-qualifying.html">article.params.title</a></h1>
                        <div class="subtitle published">2020-09-19</div>
                        <div class="content">
                            <p>予選開催から1週間が経過し、公式による解説も公開されたので自分の体験を記録しておく。</p>

<p><a href="http://isucon.net/archives/55025156.html">ISUCON10 予選問題の解説と講評 : ISUCON公式Blog</a></p>

<p>自チームのスコアも公式 Blog の全チームスコアからスクショ。</p>

<p><img src="/static/img/isucon10q.png" alt="" /></p>

<h2>メンバー</h2>

<p><a href="/entry/2019-09-09-isucon9-qualifying.html">前回</a> と同じ。<br/>
同じメンバーで継続して参加できているのは素直に嬉しい。</p>

<h2>環境</h2>

<p>今回は3人で集まる先の当てもなく（正確には当てはあるが、世間の情勢からみて推奨されない）、全員が自宅の作業環境を利用する形でオンラインで参加した。</p>

<h2>当日やったこと</h2>

<h3>開始まで</h3>

<p>30分前には集合できるように朝から用事をこなして挑んだが、開始時間が10時から12時に変更になった。<br/>
各々やるべきことはたくさんあるので、11時30分を目処に再集合することに。</p>

<p>事前に VC にどの環境を使うかだったり、リポジトリを用意しておいたりしてあったので、そのあたりを予定通りにそろえて後は開始を待つだけ。</p>

<h3>開始直後</h3>

<p>開始直後はポータルサイトが重く、ベンチマークを回すことができなかったりしたこともあり、 ISUCON の Discord サーバで運営から伝達された情報を元にマニュアルを見つけて読んだり、提供されたインスタンスへの接続を確認したりした。</p>

<p>僕がマニュアルに目を通している間に、チームメンバーの2人はインフラ周りの初期設定やローカルでアプリケーションを動かすための準備を整えてくれていた。<br/>
今回は New Relic を無料で使えるということもあり、そのあたりのセッティングも最初にしてもらった。</p>

<p>自分が最初に手を動かしたのは Logger の変更だったはず。</p>

<h3>どこから手を付けるか</h3>

<p>自分が見るべきはアプリケーションロジックかな、と目をつけソースコードを一通り読み込む。<br/>
読んだ感想として、まずはインデキシングをちゃんとやるべきだな、と考えたり、「椅子に合う物件」の判定ロジックが物件の扉の大きさと椅子の大きさを比較して椅子が扉を通れるか判定しているのがシュールだな、という感想を抱いたりした。</p>

<p>この「椅子に合う物件」を検索するクエリは冗長だな、と思ったのでウォーミングアップを兼ねて軽く直してみた。<br/>
このときに作った PR は途中でマージしたけど、あまりスコアには貢献しなかったように思う（害はなかったのでそのままになった記憶）。</p>

<h3>インデックスを作成</h3>

<p>まずはわかりやすく <code>ORDER BY hoge ASC, fuga ASC</code> になっているところに対応するインデックスを作成。</p>

<p>次に <code>ORDER BY hoge DESC, fuga ASC</code> になっているところをなんとかしたいなー、と考えたものの MySQL 5.7 では ASC と DESC が混在するソートにインデックスを聞かせることができないため、これはなにか工夫が必要だ、となって放置。<br/>
解説を見てもらうとわかるが、ここは対応すべき場所であり、放置してしまったのは当然敗因の一つ。<br/>
DESC でソートしているカラムの値を全てマイナスにして ASC にするの、全然難しくないし気づきたかったけど、やってたとき気づけなかったので絶望ですね。</p>

<p>ちなみに普段 MySQL を触ってなさすぎて INDEX 作成の構文をミスって反映されなかったりエラーになったりして時間を浪費してしまったので、ここも反省点です（ごめんなさい）。</p>

<h3>迷走</h3>

<p>インデックス作成後もそんなにスコアが伸びなかったこともあり、焦って思いつくことを乱雑に試してしまった。</p>

<p><code>SELECT *</code> のところカラム指定してみると良くなるかな、と思って試したり、定番戦術としてセッション有効にしてみたけどそもそもログインとかの概念がなかったりして、ここでも時間を浪費してしまった。</p>

<h3>N+1 の解消に挑む</h3>

<p>そうこうしているうちに、優秀なチームメンバーがなぞって検索が N+1 になっていることに気づいてくれたので、ざっと実装を見て N+1 を根本的に解消する方法と、 N+1 は解消できないけどクエリ発行回数を抑えられる方法を検討した。<br/>
チームメンバーに後者を担当してもらい、自分は N+1 の解消に挑んだが、最終的にできた PR をマージして試したところスコアが若干下がったため、 N+1 の解消は諦める形でリバートした。<br/>
ちなみにチームメンバーが作ってくれたクエリ発行回数を抑える PR は先んじてマージされ、こちらは効果があった。</p>

<h3>CSV インポート処理の改善</h3>

<p>用意されている2つのテーブルに対し、それぞれ CSV インポート機能が実装されていて、これがどちらも重そうだったので対応することに。<br/>
トランザクションを使って CSV をパースして1件ずつ INSERT をかけていたので、全県まとめて BULK INSERT するように変更してもらった。<br/>
この変更も効果があり、スコアを少し押し上げてくれたと記憶している。</p>

<h3>お片付け</h3>

<p>時間が迫っていたので New Relic 外してベンチマーク流し直して、 fail は避けられそう、かつチームとしては最高スコアが出そう、というのがわかったところで終了した。</p>

<h2>感想</h2>

<p>今回はデータベース周りの改善ポイントが非常に多く、全員が普段 MySQL を触っていないという現実が非常に重くのしかかった結果だったと思う。<br/>
Discord での感想戦の会話を追っていく中で、 MySQL のバージョンを 8 に上げたチームの話を聞いたりしてその手があったかと膝を打ったり、2テーブルしかなくて結合したクエリないからテーブルごとにインスタンス分けた、という話には「なるほどその手が……！」という驚きと自分たちがその手に気づかなかったことに対する絶望を味わわされたりした。</p>

<p>最初にリンクを張った解説を見ていても、注目すべきポイントはそんなに外していなかったな、という感じがしており、「もっと早く気付けていれば」「気づいた問題にちゃんと対処するだけの技術力があれば」という思いを抱かざるを得ない結果だった。<br/>
つまり実力不足……。</p>

<p>もっと腕を磨いて出直してこい、ということですねわかります。<br/>
そういえば以前どこかで「ISUCON 今回で一区切り説」を耳にした気がするのだけど、終了後のアンケートなどに「次に向けて意見等あれば」みたいな項目があって次回開催が期待できるな、と認識を改めたので、次回に向けてちゃんと腕を磨こうと思います。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2020-05-21-read-kaizen-journey.html">カイゼン・ジャーニーを読んだ</a></h1>
                        <div class="subtitle published">2020-05-21</div>
                        <div class="content">
                            <p>チームの課題、みたいな内容の話をしている中で紹介してもらったので、良い機会だと思って読んだ。</p>

<p>個人・チームともに漠然と <strong>生産性を上げる</strong> といっても、具体的な打ち手ってそんなに簡単には思い浮かばないもので、こういった書籍で説明されている内容は足がかりとしては最高に良いと思う。
既にやっている技法もあれば、まだやったことのない技法もあり、中にはうまく適用できれば状況を良くしてくれそうなものがあるはずで、そういう意味では今後しばらく折に触れて「読んでおいて良かったなあ」と思う機会はありそう。</p>

<p>読み進めると <strong>スクラム</strong> という単語が出てくる。
スクラム自体は僕の周囲では今や珍しいものではなく、知らない人の方が少ないのではと思うまでであるが、一方でスクラムを正しく理解・運用するのは容易ではない。</p>

<p>スクラムを学びたかったのかというとそういうわけではないが、この本を読んだ結果として「僕はもうちょっとスクラムのことをしっかり学んでも良いのではないか」と思うようになった。
今の仕事の状況は、例えるならスクラムチームを2つみている、という感じなのだが、それぞれがしっかりと基本に忠実にスクラムをやっているわけでもなく、それぞれに活かしている部分が違ったりする中で、各々のチームの現状の課題に対してこれらの知識が役に立つシーンがありそうだな、というのがその動機だ。</p>

<p>これを良いきっかけとして、もうちょっと色々とインプットしてみて、そこで得たものをチームに持ち帰りたいな、と考えている。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2020-04-16-from-the-world-where-withdrawal-is-recommended.html">引きこもりが推奨される世界で</a></h1>
                        <div class="subtitle published">2020-04-16</div>
                        <div class="content">
                            <p>まあ、なんとか生きている。</p>

<p>実は2月の中旬から勤め先でリモートが推奨されており、引きこもり生活をはじめてもう2ヶ月経った。<br/>
（良い会社ですね）</p>

<p>当然、引きこもりといっても外出はゼロではなく。<br/>
食料品、日用品を買いに行くことと通院だけは避けられないので、この2点のために数日に1回、家を出ている。</p>

<p>とはいえ平日は仕事もあり、現在の自分の仕事の内容に依存する理由ではあるけれど完全に自由な時間に働けるわけではないので、朝起きて夜寝る、といった最低限の社会性（？）は維持できている、と思う。</p>

<p>実際に引きこもり生活がそれまでの生活とどう違うのか、ちょっとだけメモしておこう、というのが今回の記事の目的。<br/>
とりあえず思いつくままに列挙する。</p>

<h2>変わったこと</h2>

<ul>
<li>通勤時間が無くなった</li>
<li>外食をしなくなった</li>
<li>歩かなくなった</li>
<li>公共交通機関を利用しなくなった

<ul>
<li>これによって読書の時間が減った気がする</li>
</ul>
</li>
</ul>


<h2>変わらないこと</h2>

<ul>
<li>概ねの起床時間と就寝時間</li>
<li>身だしなみを整える

<ul>
<li>外に出なくても、仕事を始める前にいつもどおりにルーチンをこなす</li>
</ul>
</li>
<li>三食食べてる

<ul>
<li>常にではないけど……それは今までもそうだったので</li>
</ul>
</li>
</ul>


<h2>列挙してみて</h2>

<p>……列挙してみたけど、全然変わってない。<br/>
消えた通勤時間は一体何に置き換わったんだろう。その時間を有意義に使えている気がしない。</p>

<p>外食が減ったのは少なくとも金銭的には良いこと。<br/>
こういう状況では支出を減らしたいという気持ちもあるし、一方でこういう状況だからこそ買わなければいけないものも出てくるので。</p>

<p>運動量が減っているのは良くない。<br/>
室内でできる運動って限られてるけど、やらないよりは良いはずなので、ここは意識してやっていきたい。<br/>
（そういえばリングフィットアドベンチャーは体調と相談しながらちまちま進めている）</p>

<h2>自分の中の大きな課題が迫ってきている</h2>

<p>まだたいして行動の変化ではないから上に書かなかったけど、意識面で一番変わったのは、自宅で仕事をするのに使っている部屋の環境について。</p>

<p>いろいろと物が多くて結構散らかっていた部屋だけど、滞在時間が急激に増えた結果、大掃除をしてスペースを増やすことになった（とはいえ、それが習慣化しているわけではない）。<br/>
なぜスペースを増やしたかというと、長時間パソコンに向かうのに適した環境になっていないのを改善したいと思ったから。</p>

<p>実は前々から机や椅子を買い換えようとは思っていて、とはいっても家にそんなにいないしと先送りにしてきたのだけど、ここにきて逃げられなくなった感じ。</p>

<p>外食が減って浮いたお金で部屋の環境を整えたい。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2020-04-06-clear-breath-of-the-wild.html">ブレスオブザワイルドをクリアした</a></h1>
                        <div class="subtitle published">2020-04-06</div>
                        <div class="content">
                            <p>先月末に <a href="https://www.nintendo.co.jp/zelda/index.html">ゼルダの伝説　ブレス オブ ザ ワイルド</a> をクリアした。</p>

<p>今更か、という感じもするが今更である。</p>

<p>ちなみにここでいうクリアとは「全てをやりつくした」ではなく「初めてエンディングを見た」という意味である。</p>

<p>プレイを始めたのは2017年の5月末か6月はじめ（発送お知らせメールを 5/26 に受信していることからの推測）で、そこからクリアまで3年弱かかったことになる。<br/>
基本的にオンラインで遊べる環境ではオンラインでないと遊べないゲームを優先していたことやその他諸々の事情があって、プレイ時間はそんなに長くない。<br/>
数ヶ月に一度、という頻度でのプレイだ。<br/>
2017年の秋か年末頃に「このペースで行けば、クリアは2019年の年始か春頃だろう」と予測したので約1年遅れたことになる。</p>

<p>クリアした時点での状態は以下のような感じで、やりつくしたとは到底言えない。</p>

<ul>
<li>クリアした祠は110程度</li>
<li>集めたコログのミはポーチの全拡張に40ほど不足する数</li>
<li>DLC は未適用</li>
</ul>


<p>自分にとってはとても良いゲームだったと思っていて、なので DLC も遊びたいという気持ちがあり、クリアという形で一区切りをつけてマスターモードで再プレイを始めている。<br/>
やりこむタイプではないのでコログのミ全収集をするつもりはないが、ポーチ全拡張くらいはやりたい。</p>

<p>今作のゼルダは機会があって少しプレイさせてもらったことで購入意欲を得て Nintendo Switch と一緒に購入したが、このゲームだけでもハードウェアを1つ購入した価値があったな、と思っており、でもまあまだいくつかやりたいと思っている Switch のゲームはあるので、まだまだお世話になりそうではある。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2020-02-26-in-search-of-my-best-wallet.html">財布に求めるもの</a></h1>
                        <div class="subtitle published">2020-02-26</div>
                        <div class="content">
                            <p>財布に求めるもの</p>

<p>近年、「ミニマリスト」という言葉が流行ったりして、 <strong>小さい</strong> あるいは <strong>薄い</strong> ことを売りにした財布などが出回っている。<br/>
僕はミニマリストではないが、出かける際に持ち歩く荷物を減らしたい、軽くしたいという欲求は持っていたので、いくつか試してみたりした。</p>

<p>その中で、財布に求めたい自分なりの条件というものが見えてきたのでここに記録しておく。</p>

<h2>ジッパーはいらない</h2>

<p>ジッパーが付いている財布というのはまあ、多い。<br/>
基本的には安全のため、ものによっては薄さのためについているケースもあるように見受けられる。<br/>
しかし、金銭やカードを出し入れする際にいちいち開けて閉じてをするのは非常に面倒である。</p>

<h2>紙幣を折りたたみたくない</h2>

<p>長財布が良い、という話ではない。<br/>
二つ折りあるいは三つ折りの財布自体は特に問題はない。</p>

<p>問題なのは、紙幣を格納するスペースの都合で、紙幣を折ってから入れることが求められるケースだ。<br/>
複数枚をまとめておると、1枚ずつ取り出すのがつらい。<br/>
取り出しやすさのために1枚ずつ折るのはもっとつらい。</p>

<h2>薄くても広いのはダメ</h2>

<p>薄さが魅力的な財布でも面積が広いと、ポケットによって入ったり入らなかったりする。<br/>
着る服の選択肢を減らしたくないので、広さも重要。</p>

<p>たとえば、一緒に持ち歩くスマートフォンの横幅よりも大幅に大きいのはつらい。<br/>
ベストはカードサイズのものだが、この手のものは薄さを犠牲にしている。<br/>
とはいえ薄さについては持ち運ぶカードの枚数に依存するところが大きいのと、そんなに極端に薄くなくてもよいと思っている。</p>

<h2>行き着いた結果</h2>

<p>いくつかの財布を試して、今メインで使っているのは <a href="https://www.thefrenchie.co/collections/all-products/products/speed-wallet">SPEED WALLET</a> という財布だ。</p>

<p>とりあえず最低限これとスマートフォンを持っていればある程度の外出はできる。<br/>
おそらく通勤を含む仕事も可能。</p>

<p>当然この財布に入らないものは存在して、それは別の財布（こちらもお気に入りのもの）に入れている。<br/>
そちらの財布は遠出するときなど、現金を多めに持ち歩きたかったり、関西に行くので EXIC や PiTaPa も持っていきたいときに使っている。</p>

<p>財布ひとつとっても、今の自分にとってしっくり来るものを選ぶのは簡単ではなかったし、今後僕自身の好みや生活のスタイルの変化によって、最適なものは変わっていく可能性が低くはない。<br/>
そう考えると、自分のスタイルの追求にはお金も時間もかかるけれど、これはとても充足感のある行為なので今後もちゃんとお金と時間を確保して続けていきたい。</p>
                        </div>
                    </div>
                
                </article>
            </div>
        </section>
        <footer class="footer">
            <div class="content has-text-centered">
                Copyright &copy; 2019- risou All Rights Reserved.
            </div>
        </footer>
    </body>
</html>
