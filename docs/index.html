<!DOCTYPE html>
<html>
    <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-29519043-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'UA-29519043-1');
        </script>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:title" content="risou's Lithograph" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://blog.risouf.net" />
        <meta property="og:image" content="https://blog.risouf.net/static/img/sunglass.jpeg" />
        <meta property="og:site_name" content="risou's Lithograph" />
        <meta property="og:description" content="risou's mini blog - writing about software engineering, thinking, private events" /><meta property="fb:app_id" content="2945406965474658" /><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@risou" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
        <link rel="stylesheet" href="/static/main.css">
        <title>risou's Lithograph</title>
    </head>
    <body>
        <section class="hero is-medium is-bold is-dark">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="title is-1">risou's Lithograph</h1>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <nav class="level is-mobile">
                    <div class="level-left"></div>
                    <div class="level-right">
                        <p class="level-item">top</p>
                        <p class="level-item"><a href="/list.html">list</a></p>
                    </div>
                </nav>
                <article class="articles">
                    
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2024-01-14-creating-tool-for-getting-accesstoken.html">アクセストークンを得るためのツールを作っている</a></h1>
                        <div class="subtitle published">2024-01-14</div>
                        <div class="content">
                            <p>Web で開発していると、様々なサービスのアカウントでログインする機能を作ったりとかその他諸々、 OAuth2 や OIDC のお世話になることがある。<br/>
で、そういったものを利用するソフトウェアの開発に関わっていると、試しにリクエストを行うことも多々あるわけで、その度にアクセストークンを手動で取りに行くのって面倒だな、と思っていた。</p>

<p>実際に開発が終わってしまえば、使う分にはアクセストークンを意識することはないが、底に至るまでの間にアクセストークンがほしいなというシーンがあり、そういうときに簡単にアクセストークンを取得したいな、ということでコマンド一発でアクセストークンを取れるツールを作ってみた。</p>

<p><a href="https://github.com/risou/give-me-accesstoken">give-me-accesstoken</a></p>

<p>とはいっても、これはあまり汎用的に使えるものではないと思うし、とりあえず自分や自分の周囲の同じようなことをしている人が使えればいいかな、ということでサポートしている範囲は最小限です。</p>

<p>クライアント認証方式としては <code>client_secret_post</code> と <code>private_key_jwt</code> をサポートし、 <code>authorization code grant</code> と <code>client credentials grant</code> の2種類に対応している。</p>

<p><code>authorization code grant</code> の場合は普通、途中でブラウザに飛んでブラウザ上でログインをしてからツールに戻ってくるという手順になるので、そういった挙動には対応している。<br/>
ひとまず Google と GitHub では動作の確認をしている。<br/>
ただ、自分が使いたい対象の一つが、この手法では上手く動かないことがわかっており、どうも Cookie にセッション情報がないと認可リクエストを通せないようだったので、そのケースに対応している。<br/>
これはあまり正攻法ではないし、複数の問題を内包してしまう（パスワードを設定ファイルに直書きする必要があったり、 MFA に対応できなかったり）ため、これが使われることはあまり望んでいない。<br/>
（しかし自分が必要としているから対応しているので、当然自分は使う）</p>

<p>しばらくは自分で使ってみて、問題なさそうであれば自分の周囲の人たちに紹介してみようと思う。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2023-09-12-try-using-arc.html">ブラウザを Arc に切り替えて何が変わったか</a></h1>
                        <div class="subtitle published">2023-09-12</div>
                        <div class="content">
                            <h2>Arc とはなにか</h2>

<p><a href="https://arc.net/">Arc from The Browser Company</a></p>

<p>Arc は2023年9月現在、 Mac OS や iOS に対応しているブラウザです。<br/>
Chromium エンジンを採用しているものの、見た目や使い方は大幅にカスタマイズされているため、ファーストインプレッションでは Chrome とは結構違うように思う方も多いのではないでしょうか。</p>

<p>Arc は2022年にベータ版としてリリースされ、 wait list に入っている人に順番に配布されてきました。<br/>
今年の7月25日にバージョン 1.0 として正式リリースされ、そのタイミングから誰でもダウンロードして使えるようになっています。</p>

<h2>Arc の特徴</h2>

<p>Arc はエンジンこそ Chromium を採用していますが、 Google Chrome などの同エンジンを採用しているブラウザとの違いもかなりあります。</p>

<h3>縦型タブを採用</h3>

<p>古来（？）、一部の Firefox や Chrome ユーザが拡張機能で実現してきた縦型タブが標準で採用されています。<br/>
現在のモニタは以前よりアスペクト比が高く横に長いものが多いため、縦型タブの方がスペースを有効活用できるケースが多そうです。</p>

<h3>ブックマークがない</h3>

<p>これは正確な表現ではなく、ブックマークに相当するものとして、 &ldquo;Favorites&rdquo; と &ldquo;Pinned&rdquo; があります。<br/>
&ldquo;Favorites&rdquo; はサイドバー上部にアイコンで表示され、同じプロファイルの全てのスペースに表示されるため、頻繁にアクセスするサイトを登録しておくと便利です。<br/>
対する &ldquo;Pinned&rdquo; は &ldquo;Favorites&rdquo; の下に表示され、タブ自体を閉じてもタブのリストに残り続けます。そして再びタブを選択するとそのサイトをロードしてくれます。<br/>
従来のブックマークに近いのは &ldquo;Pinned&rdquo; でしょうか。 &ldquo;Pinned&rdquo; にはフォルダも追加することができ、タブを分類して整理することも可能です。</p>

<h3>タブが自動的にアーカイブされる</h3>

<p>そして &ldquo;Pinned&rdquo; の下に通常のタブが表示されるのですが、これらは放っておくと勝手にアーカイブされます。<br/>
デフォルトでは12時間でアーカイブされる設定になっており、タブを開きすぎることを抑止してくれます。<br/>
タブがアーカイブされるまでの時間は12時間、24時間、7日間、30日間から選ぶことができます。<br/>
僕は自分の仕事におけるタブのライフサイクルに合う7日間を設定しています。<br/>
つまり1週間放置しているタブは勝手にアーカイブされるようにしています。<br/>
この設定だと、複数の調べごとをしているときなどタブが一時的に膨大な数になることはありますが、無限に放置されることはないため、気がつけば開いているタブが3桁を超えていた、という惨状を避けることができます。</p>

<h3>タブに自由に名前をつけられる</h3>

<p>通常は開いているページのタイトルが表示されているタブのラベルですが、リネームできます。<br/>
短期的に閉じられるタブでは特に使いませんが、 &ldquo;Pinned&rdquo; のタブでは非常に便利です。<br/>
（下の方で実際の使用例も記載しています）</p>

<h3>1ウィンドウで複数プロファイルを扱える</h3>

<p>Google Chrome を使っていたときは、個人用プロファイルと仕事用プロファイルを別で開いて使っており、複数の会社の仕事などしているとプロファイルが3つ以上になることもありました。<br/>
Chrome では異なるプロファイルで開いたタブを1つのウィンドウにまとめることはできないため、最低でもプロファイルの数だけウィンドウを開く必要がありました。<br/>
僕はタイル型ウィンドウマネージャを使っており、ウィンドウの数が増えると1つあたりのウィンドウの領域が狭くなっていくため、ウィンドウの数が増えることは僕にとって好ましくありませんでした。<br/>
Arc はスペースという概念を持っており、これがいわば従来のブラウザにおけるウィンドウみたいなものになるのですが、アプリケーションとしてのウィンドウは1つのままでどのスペースをアクティブにするかを選択することができます。<br/>
また、スペースごとにプロファイルを選択できるため、1つのウィンドウの中に全てのプロファイルをまとめることができます。<br/>
僕の場合は、普段は個人用プロファイルと仕事用プロファイルで1つずつスペースを用意しており、1つの仕事をちょっとペンディングして別の大掛かりな仕事に手を付けるときなどは仕事用プロファイルのスペースを追加する、という運用をしています。</p>

<h3>分割ビューに対応している</h3>

<p>Arc はなるべく1つのウィンドウで完結するように工夫されているのか、1ウィンドウの中で2つのページを開くことができます。<br/>
左右あるいは上下に分割して、片方のページを参照しながらもう片方のページで何かしらの操作をする、といったことが1つのウィンドウの中でできます。</p>

<h3>Chrome 拡張が利用できる</h3>

<p>先に書いたように Chromium エンジンを採用しており、 Google Chrome の偉大な資産である Chrome 拡張を使うことができます。<br/>
Chrome 拡張は Google Chrome の価値を高める存在であり、これを利用できることは新興ブラウザにとっては大幅なアドバンテージでしょう。<br/>
僕はプロファイルごとに Google アカウントでログインしているので、それぞれのプロファイルで Chrome を使っていたときにインストールしていた Chrome 拡張を引き継げました。</p>

<h2>個人的に便利に思っていること</h2>

<h3>一部のサイトはカーソルホバーで情報を閲覧、選択できる</h3>

<p>これはあまり対応しているサイトが多くないのでそこまで便利かというと、という気持ちもありますが対応しているサイトに関しては非常に便利なので紹介します。</p>

<p>たとえば Google Calendar を &ldquo;Favorites&rdquo; か &ldquo;Pinned&rdquo; に入れておくと、対象のアイコンもしくはタブにカーソルを合わせるだけで現在時刻から直後5時間程度の予定がバルーンで表示されます。</p>

<p>他には GitHub のプルリクエストのページを &ldquo;Favorites&rdquo; か &ldquo;Pinned&rdquo; に入れておくと、カーソルを合わせるだけで unread PRs の一覧をバルーンに出してくれます。<br/>
これは数が少々多くてもスクロールでき、なおかつ選択することでそのプルリクエストのページを開くことができます。</p>

<h3>&ldquo;Pinned&rdquo; のタブは閉じても残るため、何度もアクセスするページを登録しておくと便利</h3>

<p>僕の場合は仕事で関わっているリポジトリの Issue/PR の一覧ページを3つに分けて登録しています。</p>

<ul>
<li>my Issues: <a href="https://github.com/">https://github.com/</a>{org}/{repo}/issues/assigned/risou</li>
<li>my PRs: <a href="https://github.com/">https://github.com/</a>{org}/{repo}/pulls/risou</li>
<li>review tasks: <a href="https://github.com/">https://github.com/</a>{org}/{repo}/pulls?q=is%3Apr+is%3Aopen+user-review-requested%3A%40me</li>
</ul>


<p>これで自分が担当している Issue、自分の作った PR、自分のレビューを待っている PR を漏れなく確認することができます。<br/>
そしてこれらのタブにはそれぞれわかりやすいように <code>my Issues</code>, <code>my PRs</code>, <code>review tasks</code> というラベルをつけています。</p>

<h3>&ldquo;Favorites&rdquo; や &ldquo;Pinned&rdquo; に分割ビューをそのまま保存できる</h3>

<p>分割ビューは例えばマニュアルを見ながら操作をする、といったときなど使いどころの多い便利な機能ですが、 Arc はこの分割ビューをそのまま &ldquo;Favorites&rdquo; や &ldquo;Pinned&rdquo; に入れることができます。<br/>
つまり「マニュアルページ」「操作画面」を左右に並べた状態でブックマークができるようなものです。</p>

<h3>Note/Easel という独自機能がちょっとしたメモ代わりに便利</h3>

<p>いわばブラウザに備え付けられているテキストメモ機能とホワイトボード機能のようなものです。<br/>
Note は一時的なメモを残したり、文章を整えたりと非常に使い勝手が良いです。<br/>
Easel は Web ページを埋め込むことができます。複数の監視サービスのページを埋め込んでマイダッシュボードみたいなものを作ったりすることもできます。テキストや画像も入れることができるため、カスタマイズ性も十分です。</p>

<h3>Little Arc がちょっとした用途に便利</h3>

<p>Cmd+Option+N で開くことのできる Little Arc という一時的な別ウィンドウは、ここまで1つのウィンドウに全てを集約してきたが故の使い勝手の悪そうなイメージを払拭してくれると思います。<br/>
チャットツールに貼られたリンクをクリックする度に Arc に新しいタブが開かれることを望む人もいれば、そうでない人もいます。<br/>
Little Arc はちょっとページを開いて閲覧することはもちろん、そのまま Arc 本体にそのタブを開きたい場合にはボタン1つ（あるいはショートカット1つ）で Arc にマージすることができます。<br/>
また設定で Little Arc を経由せずに Arc で開くサイトを指定できたりする点も便利です。他のアプリケーションから開かれるページが全て Little Arc なのは逆に面倒だからです。</p>

<h2>個人的にここは微妙と思っていること</h2>

<h3>Cmd+Shift+T で復元されるタブが直前に閉じたものではないときがある</h3>

<p>閉じた直後にもう一度開きたい、となって Cmd+Shift+T を打つとしばらく前に閉じたタブが開かれたりする。<br/>
Archived Tabs を見に行けばあるのでそこから辿り着けるが、この挙動は復元されるタブが直感的にわからなくなってしまい不便。</p>

<h3>Ctrl+N で新しい Note が開いてしまう（デフォルトのキーマップの場合）</h3>

<p>キーマップを変更すれば良いだけではあるのですが、開いているページのテキストフォーム内でカーソルを下に移動するために Ctrl+N を押していると気づいたら New Note が &ldquo;Pinned&rdquo; に作られていたりします。<br/>
Mac OS の操作との重複なのでデフォルトで他のキーに割り当てられていてもいいのになあ、と思います。</p>

<h3>Note でコードブロックが表現できない</h3>

<p>Note は個人的には初期の Dropbox Paper のような使い勝手だと思っています。<br/>
見出しや太字・下線、リストなどに対応しているためちょっとしたドキュメントを作るのには便利です。<br/>
また、画像を差し込んだりリンクを設定することもできます。<br/>
一方で、テーブルやコードブロックを入れることはできません。<br/>
コードブロックとは言わないまでも、コードスニペットを貼り付けた際にその部分だけ等幅フォントに変えられると便利なのにな、と思っています。</p>

<h3>&ldquo;Pinned&rdquo; が肥大化しがち</h3>

<p>サイドバーには上から &ldquo;Favorites&rdquo; 、 &ldquo;Pinned&rdquo; 、そしてその他のタブという順に並んでいます。<br/>
タブが増えてくるとスクロールが発生しますが、 &ldquo;Favorites&rdquo; は常に最上部に残り続けます。<br/>
そのため &ldquo;Favorites&rdquo; は厳選しておくことが推奨されます。<br/>
&ldquo;Favorites&rdquo; が肥大化するとスクロールで表示される部分が狭くなってしまい、使いづらいためです。</p>

<p>そうするとブックマークしておきたいページのほとんどは &ldquo;Pinned&rdquo; に入ります。<br/>
&ldquo;Pinned&rdquo; はフォルダを置くこともできるのでうまく整理すればかなりの数を入れることはできます。<br/>
しかし Note や Easel は &ldquo;Favorites&rdquo; か &ldquo;Pinned&rdquo; にしか置けないため、ちょっとしたことで Note を作ったりしているとすぐに &ldquo;Pinned&rdquo; が肥大化します。<br/>
最終的にはその他のタブがスクロールしないと表示されない状態になり、これはあまり便利ではありません。<br/>
&ldquo;Pinned&rdquo; を整理しようにも、フォルダはフォルダで1つ分のスペースを使ってしまうので限界があります。
しかしまあ、これは使い方の問題もあるので Arc が良くない、という話ではないと思います。</p>

<h2>Arc を使って何が変わったか</h2>

<p>一番大きな変化としては、ブラウザウィンドウの乱立、タブの増殖が抑制されたことだと思います。</p>

<p>以前はブラウザが複数ウィンドウ、3桁以上のタブを開いている状態が常となっていました。<br/>
これが大幅に改善したことは非常に良い体験でした。<br/>
よくアクセスするページにはよりアクセスしやすくなりましたし、同じページを複数の異なるタブで開いてしまっているといったこともほぼなくなりました。</p>

<h2>紹介しなかった機能たち</h2>

<p>最後に、自分はあまり使っていない機能や使っているけど熱く語るほどではないものを箇条書きで列挙しておきます。<br/>
Arc は既に誰でもダウンロードできるようになっており、現在は Windows 版の開発が進んでいます（ Windows 版は wait list に登録できる状態になっています）。</p>

<ul>
<li>&ldquo;Pinned&rdquo; にあるフォルダにカーソルを合わせるとバルーンで中のリストを表示してくれる

<ul>
<li>さらにバルーン内で検索によって絞り込むことができる</li>
</ul>
</li>
<li>ブラウザ標準でスクリーンショットの機能を持っている</li>
<li>Boost 機能という、ページのカラーやフォントをカスタマイズする機能を持っている</li>
<li>Picture in Picture に対応している

<ul>
<li>Google Meet が対応しているので非常に助かっている</li>
</ul>
</li>
</ul>

                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2023-09-03-meetingbar-on-simplebar.html">simple-bar 上で MeetingBar を一部再現する</a></h1>
                        <div class="subtitle published">2023-09-03</div>
                        <div class="content">
                            <h1>MeetingBar とは</h1>

<p><a href="https://github.com/leits/MeetingBar">https://github.com/leits/MeetingBar</a></p>

<p>Mac で仕事をしていて Google Meet や Zoom を使う際に便利なツール。<br/>
メニューバー上に現在もしくは次のミーティングのタイトルや開始までの残り時間が表示される他、クリックすれば今日一日（あるいは明日も）のミーティングを確認することができる。<br/>
さらにミーティングを選んでクリックすると対応するオンラインミーティングのページを開いてくれる。</p>

<p>オンラインミーティングのページに簡単に飛べることもそうだが、次のミーティングが何で、何分後（あるいは何時間後）に始まるのかがひと目でわかるという点が非常に便利で愛用している。</p>

<h1>simple-bar とは</h1>

<p><a href="https://github.com/Jean-Tinland/simple-bar">https://github.com/Jean-Tinland/simple-bar</a></p>

<p>一方の simple-bar は Übersicht という Mac で動くウィジェットアプリで利用できるウィジェットのひとつで yabai のステータスバーとしての機能をベースにメニューバーの代替を実現するものだ。<br/>
Übersicht および yabai についてはここでは説明を省略する。<br/>
興味のある人は以下のリンクから調べてみてほしい。</p>

<ul>
<li>Übersicht : <a href="http://tracesof.net/uebersicht/">http://tracesof.net/uebersicht/</a></li>
<li>yabai : <a href="https://github.com/koekeishiya/yabai">https://github.com/koekeishiya/yabai</a></li>
</ul>


<p>僕は yabai を使っていることと、様々なアプリを活用していく中でメニューバーが乱雑になってしまっていることから simple-bar を導入した。<br/>
Mac の仕組み上、メニューバーを完全に消すことはできず、カーソルを最上部に持っていけば従来のメニューバーが出てくるため、クリックしてメニューから何かを選ぶといった操作については従来のメニューバーに任せ、 simple-bar では何かしらの作業をしながら目に入ると便利なものを表示するようにしている（おそらく simple-bar 自体がそういう用途を想定したアプリである）。<br/>
たとえば現在時刻やバッテリー残量、スピーカーの音量あたりはいつでも目視確認できると嬉しい。また最近は Spotify で BGM を流しながら作業することも多いので現在再生中の曲が見れるのも助かっている。</p>

<h1>simple-bar に次のミーティングの情報を表示したい</h1>

<p>操作が必要な事柄についてはメニューバーに任せ、普段の表示を簡素化できたという点では simple-bar に満足しているが、従来のメニューバーに表示されており simple-bar に表示されていないもののうち、これだけは外せないというものが1つある。それが次のミーティングの情報だ。<br/>
次のミーティングが何で、開始時刻がいつか、という情報は仕事を進める上で素早く確認できることが望ましい情報である。<br/>
しかし simple-bar には標準では次のミーティングを表示する機能は用意されていない。</p>

<p>ではどうするか。<br/>
simple-bar には User widgets という項目があり、コマンドやスクリプトを指定することができる。<br/>
これを使って MeetingBar の表示をそのまま再現することにした。</p>

<p>MeetingBar 自体の再発明をしたいわけではないので、既にメニューバーに存在している MeetingBar の表示内容をそのまま取得／表示できればよい。<br/>
どうやって実現するかというと AppleScript を使う。</p>

<p>AppleScript で &ldquo;System Events&rdquo; というアプリケーションを探し、その中の &ldquo;MeetingBar&rdquo; をとってくれば良い。
MeetingBar などがあるメニューバーの右側は &ldquo;menu bar 2&rdquo; に含まれているので以下のコードで MeetingBar の枠に表示されている文字列（＝現在開催中 or 次のミーティングのタイトルおよび残り時間）を取得できる。</p>

<pre><code>name of menu bar item 1 of menu bar 2
</code></pre>

<p>ついでにクリックしたときに現在開催中 or 次のミーティングの Meet の画面を開けるようにした。<br/>
これはどうやるかというと、まずメニューバー上の MeetingBar をクリックして MeetingBar のメニューを開く。<br/>
次に「開催中のミーティングに参加する」もしくは「次のミーティングに参加」というラベルのアイテムをクリックさせれば良い。<br/>
この部分の表記に関しては日本語より英語でマッチングさせた方が確実だろうと思い、 MeetingBar の言語設定を英語にしてそれぞれ &ldquo;Join current event meeting&rdquo; と &ldquo;Join next event meeting&rdquo; でマッチングさせている。</p>

<p>これで simple-bar 上に現在開催中もしくは次のミーティングの情報を表示させることと、そのミーティングのページを開くことができるようになった。<br/>
クリックしてページを開く方は、 AppleScript でメニューバーを操作している都合上、動作が緩慢ではあるが、自分にとっては少ない労力で得たリターンとして十分だと考えている。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2023-03-22-moergo-glove80-wireless-spli-ergonomic-keyboard.html">Glove80 という新しいキーボードが届いたので試している</a></h1>
                        <div class="subtitle published">2023-03-22</div>
                        <div class="content">
                            <p><a href="https://www.moergo.com/">MoErgo Glove80 Wireless Split Ergonomic Keyboard</a></p>

<p>Glove80 は、昨年 Kickstarter でクラウドファンディングしていた分割キーボードだ。<br/>
以下のような特徴を持っている。</p>

<ul>
<li>お椀型

<ul>
<li>※お椀型という表現が一般的かはわからない</li>
<li>Kinesis Advantage のような中心がくぼんでいるタイプ</li>
</ul>
</li>
<li>分割キーボード

<ul>
<li>Kinesis も分割キーボードに分類できるが Glove80 は左右が完全に分離している</li>
</ul>
</li>
<li>ロープロファイル</li>
<li>BLE 対応

<ul>
<li>ワイヤレスで複数の端末に繋ぐことができる</li>
<li>左右も有線で繋ぐ必要がない</li>
</ul>
</li>
</ul>


<p>この手のクラウドファンディングはあまり手を出さないようにしているが、これは非常に興味をそそられたので悩みに悩んで投資をした。<br/>
当時はまだ円安が進行する前だったから挑戦できた、というのはあるかもしれない。</p>

<p>当初は昨年秋頃に完成して順次発送する、という計画だったが様々な事情で pledge した全員への発送は3月中旬になったようだ。<br/>
（既に全員への発送が完了したというメールが送られており、居住地によって受け取りのタイミングは前後するだろうが程なく全員が受け取れるはず）<br/>
僕自身は10月くらいからおよそ半年間、まだかまだかと待つことになった。一日千秋とはこのことである。<br/>
開発者の方々は毎月進捗を共有してくれていて、これも楽しみにしていた。<br/>
（iOS の標準機能で英語を翻訳できるのは非常に便利）</p>

<p>今朝届いて、半日ほど触った感触を以下に記しておく。</p>

<h3>思った以上に軽い</h3>

<p>当初から持ち運ぶことも想定しているようだったので、重くはないだろうと思っていたが、手に持ってみると想像以上に軽かった。<br/>
ただ、形状の問題で厚みはどうしても存在するので、持ち運ぶかというと悩ましい。<br/>
持ち運びに適した袋なりケースなりの都合がつけば、持ち運びたくはある。</p>

<h3>打鍵感はかなり良い</h3>

<p>過去に最も使ってきたのは茶軸で、たぶん一番好きなのはピンク軸（静音赤軸）なのだが、選択肢に静音系がなかったので赤軸を選んだ。<br/>
赤軸のロープロファイルは初めてで、どんなものかと思っていたが個人的にはかなり好みだった。<br/>
これについてはキーキャップの材質もあるかもしれない。</p>

<h3>キーボードの土台はちょっと荒削り</h3>

<p>お椀型なので作りの難易度は高そうだが、頑丈さは申し分なさそう。<br/>
ただ、角の部分が尖っており、持ち方によっては痛く感じるかもしれないのは気になるところ。</p>

<h3>足の高さ調節がネジ式なのがちょっと気になる</h3>

<p>6つある足のうちの1つだけが固定されており、残りの5つは高さを調節できるようになっている。<br/>
一番短い状態にしておき、机に置いたときに浮くものだけ、接地するようにネジを緩めることでキーボードが安定する。</p>

<p>そのまま机の上に置いて使う分には問題ないが、場所を動かしたり持ち運んだりしようとすると、ネジを緩めた足がカチャカチャなったり、緩めすぎているとふとした拍子に外れてしまうこともあった。<br/>
これは持ち運びの際にも注意が必要なポイントだと感じる。</p>

<h3>親指キーがどれも押しやすい</h3>

<p>ロープロファイルだからというのもあるかもしれないが、自分が所有する親指用にいくつかのキーを持つキーボード（Kinesis や Ergodox EZ など）と比較して、親指キーの奥側が押しやすいと感じる。<br/>
これまで親指キーは手前は押しやすいものの奥は押しづらい印象があったが、絶妙な高さの違いとロープロファイルという条件が噛み合って奥のキーも押しづらさがないのは非常に良い。</p>

<h3>押し間違いは増えてしまった</h3>

<p>慣れるまでの一時的なものかもしれないが、タイプミスは一時的に増えている。<br/>
Kinesis も結構長期間使っているので、タイプミスはあまり心配いらないかと思ったが、当然全く同じ形状ではないのでタイプミスは増えているように感じる。<br/>
お椀型はどうしても手の大きさや指の長さによって適合度合いが変わってしまうので仕方がない。<br/>
自分の指の長さだと近すぎるように感じるキーがいくつかあるので、これだけは慣れていくしかない。<br/>
とはいえ、自分の手の大きさ、指の長さであれば許容範囲という感じがする。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2023-02-10-2023-02-10-golang-maxage-caution.html">Golang で Cookie を扱うときは Max-Age の指定方法に注意が必要</a></h1>
                        <div class="subtitle published">2023-02-10</div>
                        <div class="content">
                            <p>近年では Chrome が Cookie の有効期限の上限を定めるなど、 Cookie を扱う上で有効期限は軽率にしてはいけないものという認識が広がってきているように思う。<br/>
Cookie の有効期限の指定については歴史的経緯で <code>Expires</code> を指定する方法と <code>Max-Age</code> を指定する方法の2つがあり、モダンブラウザと呼ばれるものであれば大体は両方指定されている場合は <code>Max-Age</code> が優先されるようになっている。</p>

<p><code>Max-Age</code> には <strong>「その Cookie がセットされてから何秒後まで有効か」</strong> を整数で渡すことができるようになっており、よく見るものだと「24時間有効とする <code>60 * 60 * 24</code> 」や「1年有効とする <code>60 * 60 * 24 * 365</code> 」という値がコード上ではセットされている。<br/>
当然、実際に通信される際の値は計算済みのものだし、ブラウザでは受け取った日時から指定された秒数を足した絶対時間で Cookie を保持している。</p>

<p><code>Max-Age</code> および <code>Expires</code> が指定されていない場合、その Cookie はセッション終了時に消えるようになっており、ブラウザが閉じられたタイミングで消える。ただしブラウザがセッションを復元する機能を持っている場合、再度ブラウザが開かれたタイミングで Cookie も復元されることもある。</p>

<p>また <code>Max-Age</code> には 0 や負数を設定することもでき、この場合ブラウザ側は有効期限として表現可能な最も古い日時をセットする。当然この表現可能な最も古い日時は過去日時であるため、その Cookie は直ちに破棄される。</p>

<p>さて、ようやく本題に入るが、 Golang で Cookie を扱う際にはおそらく一般的には net/http パッケージの Cookie 構造体を利用すると思う。<br/>
そしてこの Cookie 構造体を用いて Cookie の設定をする際には <code>Max-Age</code> の値のセットの仕方に注意が必要だ。</p>

<p>具体的に注意が必要になるのは 0 である。<br/>
先に書いたように Cookie の仕様としての <code>Max-Age</code> は以下のようになっている。</p>

<ul>
<li><code>Max-Age</code> に正の整数が指定されていれば、 Cookie を受け取った時間から <code>Max-Age</code> 秒後にその Cookie は有効ではなくなる</li>
<li><code>Max-Age</code> に 0 もしくは負の整数が指定されていれば、その Cookie は直ちに破棄される</li>
</ul>


<p>しかし net/http パッケージの Cookie 構造体が受け取る <code>MaxAge</code> フィールドの挙動は若干異なる。<br/>
<a href="https://pkg.go.dev/net/http#Cookie">https://pkg.go.dev/net/http#Cookie</a> には <code>MaxAge</code> フィールドについて以下のようにコメントが記載されている。</p>

<pre><code class="golang">    // MaxAge=0 means no 'Max-Age' attribute specified.
    // MaxAge&lt;0 means delete cookie now, equivalently 'Max-Age: 0'
    // MaxAge&gt;0 means Max-Age attribute present and given in seconds
</code></pre>

<p>つまりこうだ。</p>

<ul>
<li><code>MaxAge</code> に正の整数が指定されていれば、 Cookie を受け取った時間から <code>MaxAge</code> 秒後にその Cookie は有効ではなくなる（ <code>Max-Age</code> にそのまま値が渡される）</li>
<li><code>MaxAge</code> に負の整数が指定されていれば、その Cookie は直ちに破棄される（ <code>Max-Age</code> には 0 が設定される）</li>
<li><code>MaxAge</code> に 0 が指定されていれば、そのCookieはセッションが閉じられるまで有効である（ <code>Max-Age</code> を <strong>指定しない</strong> ）</li>
</ul>


<p>net/http の Cookie 構造体経由で Cookie を扱うのであれば Cookie 構造体の <code>MaxAge</code> とリクエスト／レスポンスで扱われる <code>Max-Age</code> の違いを理解しておく必要がある。</p>

<table>
<thead>
<tr>
<th style="text-align:center;"> <code>MaxAge</code> (Golang) </th>
<th style="text-align:center;"> <code>Max-Age</code> (HTTP) </th>
<th style="text-align:left;"> 有効期限 </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"> N > 0 </td>
<td style="text-align:center;"> N </td>
<td style="text-align:left;"> N 秒後まで </td>
</tr>
<tr>
<td style="text-align:center;"> N &lt; 0 </td>
<td style="text-align:center;"> 0 </td>
<td style="text-align:left;"> 期限切れ </td>
</tr>
<tr>
<td style="text-align:center;"> 0 </td>
<td style="text-align:center;"> - </td>
<td style="text-align:left;"> セッションが閉じられるまで </td>
</tr>
</tbody>
</table>

                        </div>
                    </div>
                
                </article>
            </div>
        </section>
        <footer class="footer">
            <div class="content has-text-centered">
                Copyright &copy; 2019- risou All Rights Reserved.
            </div>
        </footer>
    </body>
</html>
