<!DOCTYPE html>
<html>
    <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-29519043-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'UA-29519043-1');
        </script>
        
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:title" content="risou's Lithograph" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://blog.risouf.net" />
        <meta property="og:image" content="https://blog.risouf.net/static/img/sunglass.jpeg" />
        <meta property="og:site_name" content="risou's Lithograph" />
        <meta property="og:description" content="risou's mini blog - writing about software engineering, thinking, private events" /><meta property="fb:app_id" content="2945406965474658" /><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@risou" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
        <link rel="stylesheet" href="/static/main.css">
        <title>risou's Lithograph</title>
    </head>
    <body>
        <section class="hero is-medium is-bold is-dark">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h1 class="title is-1">risou's Lithograph</h1>
                </div>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <nav class="level is-mobile">
                    <div class="level-left"></div>
                    <div class="level-right">
                        <p class="level-item">top</p>
                        <p class="level-item"><a href="/list.html">list</a></p>
                    </div>
                </nav>
                <article class="articles">
                    
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2019-09-30-only-play-board-game-with-risou-32.html">不定期に集まってボードゲームをしている</a></h1>
                        <div class="subtitle published">2019-09-30</div>
                        <div class="content">
                            <p>2013年くらいから僕が主催しているボードゲームをするためだけの集まりがある。<br/>
主催するといっても、僕がやるのは日程調整と会場の確保だけで、あとは僕がいようがいまいが適当に回っている。<br/>
（イベントのタイトルが「 risou さんとボードゲームやれるよ」と言わんばかりの内容なのに僕がいない会があるのはアレだけど）<br/>
幸いにも僕の周りには <strong>とても</strong> たくさんボードゲームを持っている方が4, 5人いて、そういう人たちのおかげで楽に開催できている。</p>

<p>先日、3か月ぶりくらいに開催した。<br/>
記録が正しければ32回目の開催で、参加人数は実績値で17人（たぶん）。<br/>
一応、プライベートイベントという扱いで、僕の知り合い（および彼らが連れてきてくれる人たち）しか参加できないようにしているので、人数としてはこれくらいで安定している。<br/>
過去実績では20人を超えたことが何度かあり、そういうときは会場選定に少し困ったりしていた。</p>

<p>このイベントは参加者の善意によって成り立っていて、ルールらしいルールがほとんどない。<br/>
勝手に集まって、勝手に適切な人数に分かれて、勝手にゲームが行われる。<br/>
当然ボードゲームをしなくてもよく、僕が終了1時間くらい前に顔を出してボードゲームをせずに会計だけして去ったこともある。</p>

<p><img src="/static/img/dice_forge.jpg" alt="サイコロを拡張するのに楊枝を携帯している様子" /></p>

<p>僕の知り合いがコアな参加メンバーになるので当然かもしれないが、参加者の年齢層は僕を中心に（正確には中心よりやや上に）±10歳くらいにおさまっている。<br/>
が、過去実績で最年少参加者は3歳（当時）でその子は現在は小学生になっている。先日開催時にも来てくれた。</p>

<p>また、時折ボードゲームを作っている人が来てくれたりして、その人の作品をプレイしたり、発表前の作品をテストプレイしたりもしている。</p>

<p>そんな会だが、これまでの一番の課題は会場選定だった。<br/>
基本的には貸し会議室等を利用することが多く、代金を会場代として参加者から徴収する形になっていた。<br/>
しかし、ボードゲームを買って会場代を支払って、となると経済的な負担も馬鹿にできない。<br/>
（参加者は気にしていないかもしれないが主催者は気にしている）</p>

<p>今回、紆余曲折あって僕がお世話になっている会社の会議室を借りて開催することができた。<br/>
これまでも企業に会議室を借りる案はないことはなかったが、比較的プライベートなイベントでもあるため、企業にペイできるものがないことがネックだったりしたが、今回はそのような問題もなく（おそらくは）平和的に場所を確保できたように思う。<br/>
参加者によって使いやすい会場だったかどうかはこれから確認するつもりだが、問題なければ同じ会場で継続して開催できると精神的な負担は少なくすみそうだと思っている。</p>

<p><img src="/static/img/tokyo_highway.jpg" alt="高速道路を作っている様子" /></p>

<p>残る課題は、 <strong>皆が持ってきてくれたは良いが数が多すぎて遊びきれていないゲームたちを如何にして遊ぶか</strong> や <strong>スケジュールが連続して合わないと1年くらい（以上）参加できない人がいる</strong> ことかなと思っており、今後は開催ペースは少し上げられたら、と思っている。</p>

<p>このイベントに参加してボードゲームをプレイしてみたいと思う良識ある僕の知り合いの方は Twitter の DM や Facebook Messenger あるいは LINE, Slack, Discord 等のプライベートな連絡手段で僕に声をかけてください。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2019-09-21-eye-surgery.html">目の手術をした話</a></h1>
                        <div class="subtitle published">2019-09-21</div>
                        <div class="content">
                            <p>もうしばらく前の話だけど、目の手術をした。<br/>
網膜光凝固術というもので、網膜剥離等の症状に対して有効な手術らしい。</p>

<p>どういう経緯でこの手術を受けることになったのか、どんな手術だったのかを記録しておく。</p>

<hr />

<p>実は前々から眼鏡を作り直すために一度眼科に行こうと思いつつ、急ぎでもないしズルズルと先延ばしにしていた。<br/>
あるとき、仕事で長時間連続稼働したときに普段以上に「目の疲れ」を感じることがあった。<br/>
そのタイミングで「これは近いうちに眼科に行って目に異常がないか診てもらったほうがよいな」と思った。</p>

<p>なんとか予定を調整して、平日の朝早くに近くの眼科に行って検査してもらった。<br/>
順番待ちや検査用の目薬の効果を待つ時間もあり、実際に検査ができたのは昼前だったが、目を見てその場で「網膜に穴が開いている」と言われた。<br/>
症状としては網膜裂孔というもので、眼球に衝撃が加わると網膜剥離する可能性があるという説明を受けた。
網膜裂孔と診断した医者はとても軽いノリで、「で、この診察終わるの待って手術する？　夕方もう一度来て手術する？」と聞いてきた。<br/>
色々と手術にかかる時間や術後のことなどを確認して、「じゃあ夕方で」となって一旦帰宅した。</p>

<p>夕方まで自宅で仕事を進め、急ぎのものはないという状況まで持っていって再度病院に向かった。<br/>
麻酔を含め、点眼薬の効果を待ってから、予定通り手術を受けた。</p>

<p>光凝固術はレーザーによって網膜の対象箇所を焼き切って固める手術らしい。<br/>
この手術によって症状が回復するわけではないが、その後の悪化を止めることができるそうだ。<br/>
光凝固術は数分で終わり、即日（というか術後わりとすぐに）退院できる。<br/>
これらの説明は午前中に受けていたが、実際に手術する準備が整って「さあ、レーザーを照射するぞ」というタイミングで、医者が「そういえば料金の説明をしてなかった」などと言い出した。<br/>
僕自身は高額になれば高額医療費制度が使えるし、一時的に手持ちのお金が減ってしまう分にはなんとかなるだろうと気にしていなかったが、まあ雑な医者ではある。<br/>
（一方で手術を受けるにあたってサインをしたときに料金を聞いていない僕も僕である）<br/>
レーザーを照射する台の前に頭を固定した状態で、だいたいの料金について聞き、その場で了承した。</p>

<p>手術自体は5分前後で終わったと思う。<br/>
後から聞いた話では 210 発照射されたらしい。<br/>
「痛みはない」みたいな話を聞かされていたが、数発目くらいから脳に直接刺激が来るような痛みがあり、それは最後まで続いた（我慢できないほどではなかった）。<br/>
終わった直後は、レーザーを照射された方の目は完全にバグっていて、そちらの目では世界が（特にモニタから発される光が）マゼンダに見えた。<br/>
（当たり前というか残念というか、この症状は数分後には完全に落ち着いていた）</p>

<p>その後は普通に料金（高額だったので一部）を支払って帰宅した。<br/>
頭痛があったのでその日は最低限やるべきことをやってすぐに寝たが、次の日から普通に出社して仕事ができた。<br/>
術後は最大3週間ほど安静にしている必要があり激しい運動等が禁止されたが、つらかったのは「階段を駆け降りる」ことが禁止されたことくらいだった（つい癖でやってしまう）。<br/>
その後は術後1週間と3週間のタイミングで検査し問題ないことを確認して、ついでに後日視力を検査してもらって通院を完了した。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2019-09-20-nurture-lithograph.html">Lithograph を育てる</a></h1>
                        <div class="subtitle published">2019-09-20</div>
                        <div class="content">
                            <p>毎日ブログを書くような性格でもないのだが、前回の記事から今日までの間、隙を見つけては Lithograph を育てていた。<br/>
育てるといってもたいしたことはしていない。<br/>
（実はバージョンを上げてすらいない）</p>

<p>改善内容は以下。</p>

<ul>
<li>Travis CI での build の実行結果を Slack に通知するサンプルを追加</li>
<li>Google Analytics のタグを埋め込めるようにした</li>
<li>OGP 用のタグを設定できるようにした</li>
<li>build 用のシェルに <code>-eu</code> を設定</li>
</ul>


<p>だいたいこれくらい。<br/>
自分で使っているうちに、「あれもできたらな」と思ったものに対応していっている感じだ。</p>

<p>他にも改善したいことはあるが、これはたぶんすぐにはやらないだろうな、というものもある。<br/>
例えば、</p>

<ul>
<li>初期セットアップ時に生成するリソースファイルのみ更新するコマンドの追加

<ul>
<li>Lithograph 本体側で設定ファイル等に更新があった場合に反映したい</li>
</ul>
</li>
<li><code>config.yml</code> に必要な項目が揃っているかをチェックする機能

<ul>
<li>あると良いかもだけど、今は必須項目もほぼないのでなくてもいいかな</li>
</ul>
</li>
<li>既にファイルのあるディレクトリでの初期セットアップを抑制する機能</li>
</ul>


<p>あたり。これらはあると便利そうな気がするけど、あんまり頻繁に使われるものではないので実装を急いでいない。</p>

<p>時間さえ見つけられれば（他に優先度の高いものがなければ）やりたいのは主に build 周りの改良で、</p>

<ul>
<li>「次の記事」「前の記事」へのリンクを付けられるようにする</li>
<li>記事にタグを付けられるようにして、タグでフィルタしたリストページを作る</li>
<li>更新のない記事の build をスキップする</li>
</ul>


<p>などは後々のことを考えるとやっておきたい。</p>

<p>けれど、他にもやるべきことがあったりするので、これらはまたそのうち時間を見つけて、といった感じ。</p>
                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2019-09-10-builderscon2019.html">builderscon 2019 の記録</a></h1>
                        <div class="subtitle published">2019-09-10</div>
                        <div class="content">
                            <p>もう1週間以上前<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>のことだけど、今年も行ってきたので自分のためにログを残しておく。<br/>
といっても写真は全然撮ってないし、ボリューム厚めのログは勤め先の情報共有ツールの方に書いたので、こちらには軽く書くだけ。</p>

<p><a href="https://builderscon.io/tokyo/2019">builderscon 2019</a></p>

<p><a href="/entry/2018-09-11-builderscon-tokyo-2018.html">去年の記事</a></p>

<h2>会場</h2>

<p>去年と異なり、北千住の東京電機大学。<br/>
北千住自体は初めてではないけど、実は駅周辺のこととかあまり知らなかったので、雰囲気が知れてよかった。</p>

<p>ちなみに運営の心遣いのレベルが高く、最寄り駅から会場への経路を <a href="https://blog.builderscon.io/entry/kitasenju_directions">ブログで詳しく解説</a> してくれているが、僕は見逃して普通に迷ったりしました。</p>

<h2>チケット</h2>

<p>今回は <a href="https://blog.builderscon.io/entry/2019/06/12/120000">コンプリートパック</a> なるものがあり、これを買っておくと後々別途チケットが販売される懇親会等のチケットを購入する必要がなくなるということで、バーンと買っちゃいました。<br/>
もちろん全部入りだけあって相応に高額であり即決できるほどではなかったのですが、面倒なことは苦手なので「用意されてるチケット数少ないし、売り切れる前に……」と買ってしまった、という流れです</p>

<p><img src="/static/img/builderscon_2019_nametag.jpg" alt="" /></p>

<h2>トーク</h2>

<p>前夜祭や LT を除けば、だいたいどの時間帯も複数のトークが並行して行われており、今回だと最大5並列くらいだった気がする。<br/>
それだけあれば、聞きたいトークが2つないし3つくらいはかぶるもので、毎時間「どれ聞きに行こう……」ってなりました（贅沢な悩み）。</p>

<p>ひとつひとつに言及すると長くなってしまうので、これはすごかったなというのを上げると、</p>

<ul>
<li>スーパーカミオカンデ</li>
<li>RDB のトラブル</li>
<li>Oxygen Not Included</li>
</ul>


<p>あたりはとても印象に残った。また、聞けなくて悲しい思いをしたトークもいくつもあり、特にサイバー攻撃日誌は聞きに行きたかった。</p>

<p>builderscon は後日各トークの録画が公開されるはずなので、それを楽しみに待つ次第。</p>

<h2>スポンサード</h2>

<p>今の勤め先では、いくつかのカンファレンスにスポンサードしており、 builderscon にスポンサードすることも不可能ではなさそうな気がしている。<br/>
とはいえむやみにカンファレンスにスポンサードしても勤め先にメリットがなければ意味がないので、そこを考慮してスポンサードを打診していない。<br/>
でも勤め先の同僚が参加して得るものがないとは全く思わないので、同僚たちがもっと参加してくれると嬉しいなあ、と思う。</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p><a href="/entry/2019-09-09-isucon9-qualifying.html">1つ前の記事</a> の ISUCON よりも前のイベント。順番がおかしい。<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

                        </div>
                    </div>
                
                    <div class="article">
                        <h1 class="title is-2"><a href="/entry/2019-09-09-isucon9-qualifying.html">ISUCON 9 予選惨敗記録</a></h1>
                        <div class="subtitle published">2019-09-09</div>
                        <div class="content">
                            <p>惨敗した。</p>

<p><img src="/static/img/isucon9q.png" alt="" /></p>

<p>当日のログもあまり残せておらず、記憶がすぐに劣化してしまいそうなので乱文になるかもしれないがここに記録しておく。</p>

<h2>参加のきっかけ</h2>

<p>社内の Slack で「興味ありそうな人がいれば出たい」という趣旨の発言をしたところ、反応があったのでさっとチームを組んで参加することにした。<br/>
3人での参加だったが、当然この組み合わせは初だった（もっというと僕以外の2人は ISUCON 自体初参加だった）。</p>

<h2>当日までの準備</h2>

<p>仕事が忙しかったことを主な言い訳にするが、3人揃って時間を確保して過去問を解く、といったことはできなかった。</p>

<p>何度か集まって話をする時間を設けることができ、そこで序盤の進め方や役割分担について話をしておいた。<br/>
また、提示された環境で（インフラ担当の方に）インスタンスを立ててもらって鍵認証で SSH 接続できること、などは確認しておいた。<br/>
当然だが、この時点で言語も選択していた。会社で使っているということもあり Ruby を選択した。</p>

<h2>当日の動き</h2>

<h3>集合〜セットアップ</h3>

<p>同僚との参加だったので必然的にオフィスに集まることになった。<br/>
休日はビルの施錠周りにややこしい部分があり、経験豊富な僕が解錠する役を請け負った<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>。</p>

<p>実は我々以外にもう1チーム、同じオフィスを利用するチーム<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>がおり、そちらの皆さんのためにもあまり遅くならないようにオフィスを開ける必要があった。</p>

<p>余裕をもって 8:30 頃に出社し、同じオフィスで参加する皆を迎え入れた。<br/>
並行して3人が近い席で作業できるようにディスプレイやキーボードなどをセットアップしたり、ホワイトボード、会議用モニタ + Apple TV を座席近くに集めた。</p>

<p>時間的には結構余裕を残して準備を終えられたと思う。</p>

<h3>開始〜昼頃</h3>

<p>開始してすぐに、インフラを担当してくれる方にインスタンスを立ててもらったり、鍵を配備してもらったりして、準備が整ったらまずは一度ベンチマークを走らせてもらった。</p>

<p>並行してもう1人の同僚が初期コードを Git で管理管理できるようにしたりデプロイ周りを整えてくれたりした。</p>

<p>僕はドキュメントを読み漁ったり、コードを軽く読んだりした。</p>

<p>ベンチマークの結果が出たあたりで一度コミュニケーションを取り、各々の初手を相談して動きを決めた。</p>

<p>この時間帯は MySQL のスロークエリを探して、インデックスを張ったりしていたと思う。<br/>
並行して alp での計測結果をもとに <code>/users/transactions.json</code> の実装を調べたりしていたはずだ。</p>

<p>結局、昼過ぎの時点ではスコアに全く影響を与えることができなかった。</p>

<h3>昼過ぎ〜夕方</h3>

<p>正直、記憶がだいぶ曖昧で何をしていたか覚えていない。</p>

<p>Job を見る限りでは14時台に何度かベンチマークを実行し、 <code>/initialize</code> で fail したりしていたようだ。<br/>
おそらく app と db でインスタンスを分けて、別インスタンス上の DB に接続しにいくあたりで環境変数に <code>127.0.0.1</code> が入ってしまってうまくいかないとか、そういうことをやっていた気がする。<br/>
あとログ出したいよね、という話をしていた記憶があるのでそのあたりを頑張っていたような……。</p>

<p>15時台になると success するようになり、ベンチマークの結果が若干上にブレたり下にブレたりしていた様子（しかし例によって記憶がない）。</p>

<h3>夕方〜終了</h3>

<p>最終的に MySQL のスロークエリが <code>SELECT * FROM categories</code> ばかりになったので、「これ変更されないマスタデータだし、起動時に全部取得してキャッシュしようぜ」って考えてシュッと実装した。</p>

<p><code>WHERE parent_id = ?</code> のところはインデックスを張っていたのでスルーしたのと、 <code>/settings</code> でカテゴリのリストを取得している箇所も（そのまま出力しているのが気になったので）そのままにしておいた。</p>

<p>このキャッシングは若干の効果があったようでチームとしてはここで初めて初期スコアを脱出した感じになった。</p>

<p>その後、 <code>/users/transactions.json</code> のクエリ発行周りをいじって動かしてみたり <code>SELECT *</code> なクエリのカラムを指定する形に変更してみたりしたが、時間があまり残っていなかったこともあり、スコアが変わらなかったりベンチマークが fail してしまう変更は結局取り込まなかった。</p>

<p>終盤になると、3台構成のインスタンスを app 2台、 db 1台にして app をバランシングしようとしていたが、画像アップロードの問題があり苦戦したあげく、バランシングした方がスコアが落ちてしまったので、これもやめた（結局最後まで app 1台、 db 1台で進めた）。</p>

<p>また、序盤から存在が気になっていた <code>campaign</code> という項目の値を変化させてベンチマークを一通り動かしてみた。この項目には 0〜4 の整数が入り得ることがわかっており、5パターンのベンチマークを試して、最もスコアが出る値を入れることにした。<br/>
（このタイミングの変更としては、これが一番スコアに貢献した）</p>

<p>最後に仕込んでいたログを消したり、再起動してもベンチマーク通ることを確認したりして終了時間を迎えた。</p>

<h2>雑感</h2>

<h3>問題</h3>

<p>とても良い、そして難しい問題だったように思う。<br/>
スコアを上げるためには、ちゃんとシステムがやりたいこととやっていることを理解することが必要だったのではないだろうか。<br/>
セオリー通りにこれをやっておけばとりあえずスコアが上がる、という簡単さはあまり感じられなかった。</p>

<h3>進め方</h3>

<p>色々と反省はある。</p>

<ul>
<li>練習不足が如実に出て、序盤の立ち上がりが遅かった</li>
<li>デプロイ用にシェル書いてもらったりしたけど、ほとんど使わなかった</li>
<li>バージョン管理していたけど、インスタンス上でコードいじったりもした

<ul>
<li>バージョン管理の目的はローカルでのコード編集だけではないので、バージョン管理をしたのは良かった</li>
</ul>
</li>
<li><code>campaign</code> の値変更はもっと早めに一度試しておくべきだった

<ul>
<li>値によって何が変わるのかの把握が遅かった</li>
</ul>
</li>
<li>実装の読み込みが浅かった</li>
<li>ホワイトボード、 Apple TV を活かせなかった</li>
</ul>


<p>一方で良かったな、と思うこともある。</p>

<ul>
<li>初参加（初組み合わせ）にしてはよく動けたと思う</li>
<li>役割分担が自然にできた</li>
<li>インスタンス利用やベンチマーク実施を相談しながら進められた</li>
<li>その時々で、誰が何をやるかの認識合わせができた</li>
<li>終盤、戻しの判断が安全で安心感があった

<ul>
<li>駆け込みベンチマークでヒヤヒヤしたり、終盤で0点に怯えたりせずに済んだ</li>
<li>業務ではないのでもう少しチャレンジしても良かったとは思う</li>
</ul>
</li>
</ul>


<p>まとめると <strong>実力不足を感じつつも、まだまだやれそうな気配もあり、悔しい思いをした</strong> といったところ。</p>

<p>心が折れて次回参加する流れにならないことが最も懸念していた展開だったので、チームの誰も心が折れず、リベンジの意欲を高く持って終わりを迎えられたので、それは本当に良かった。</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>正直これが一番の大仕事だったと思っている。<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>このチームの1人が同僚であり、ちゃんと会社の許可を得て利用している。<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

                        </div>
                    </div>
                
                </article>
            </div>
        </section>
        <footer class="footer">
            <div class="content has-text-centered">
                Copyright &copy; 2019- risou All Rights Reserved.
            </div>
        </footer>
    </body>
</html>
